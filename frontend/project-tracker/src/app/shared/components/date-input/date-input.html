<!-- Standard Layout -->
@if (visualizationType === 'standard') {
  <div class="mb-3">
    <label [for]="inputId" class="form-label">
      {{ label }}
      @if (required) {
        <span class="text-danger">*</span>
      }
    </label>
    <div class="input-group">
      <input
        type="text"
        [id]="inputId"
        class="form-control"
        [class.is-invalid]="hasError()"
        [value]="displayValue()"
        [disabled]="disabled()"
        [placeholder]="placeholder || localizedPlaceholder()"
        [attr.aria-label]="label"
        [attr.aria-required]="required"
        [attr.aria-invalid]="hasError()"
        [attr.aria-describedby]="hasError() ? inputId + '-error' : helpText ? inputId + '-help' : null"
        (input)="onInput($event)"
        (blur)="onBlur()"
        autocomplete="off">
      <button
        class="btn btn-outline-secondary"
        [class.btn-outline-danger]="hasError()"
        (click)="togglePicker()"
        type="button"
        [disabled]="disabled()"
        [attr.aria-label]="'Open calendar'">
        <i class="fas fa-calendar"></i>
      </button>
    </div>
    @if (hasError()) {
      <div [id]="inputId + '-error'" class="invalid-feedback d-block">
        {{ errorMessage() }}
      </div>
    }
    @if (helpText && !hasError()) {
      <div [id]="inputId + '-help'" class="form-text">
        {{ helpText }}
      </div>
    }
    
    <!-- Calendar Picker Popup -->
    @if (showPicker()) {
      <div class="position-relative">
        <div class="calendar-picker-popup card shadow-lg position-absolute top-0 start-0 mt-1" style="z-index: 1050;">
          <div class="card-body p-3">
            <!-- Month/Year Navigation -->
            <div class="d-flex justify-content-between align-items-center mb-3">
              <div class="btn-group btn-group-sm" role="group">
                <button type="button" class="btn btn-outline-secondary" (click)="previousYear()" title="Previous year">
                  <i class="fas fa-angle-double-left"></i>
                </button>
                <button type="button" class="btn btn-outline-secondary" (click)="previousMonth()" title="Previous month">
                  <i class="fas fa-angle-left"></i>
                </button>
              </div>
              
              <h6 class="mb-0 fw-bold">{{ currentMonthName() }} {{ currentYear() }}</h6>
              
              <div class="btn-group btn-group-sm" role="group">
                <button type="button" class="btn btn-outline-secondary" (click)="nextMonth()" title="Next month">
                  <i class="fas fa-angle-right"></i>
                </button>
                <button type="button" class="btn btn-outline-secondary" (click)="nextYear()" title="Next year">
                  <i class="fas fa-angle-double-right"></i>
                </button>
              </div>
            </div>

            <!-- Weekday Headers -->
            <div class="calendar-grid mb-2">
              @for (weekDay of weekDayNames(); track $index) {
                <div class="calendar-weekday">{{ weekDay }}</div>
              }
            </div>

            <!-- Calendar Days -->
            <div class="calendar-grid">
              @for (dayInfo of calendarDays(); track dayInfo.date) {
                <button
                  type="button"
                  class="calendar-day"
                  [class.other-month]="!dayInfo.isCurrentMonth"
                  [class.today]="dayInfo.isToday"
                  [class.selected]="dayInfo.isSelected"
                  [disabled]="dayInfo.isDisabled"
                  (click)="selectDate(dayInfo.date)"
                  [title]="dayInfo.date">
                  {{ dayInfo.day }}
                </button>
              }
            </div>

            <!-- Footer with Today and Close buttons -->
            <div class="d-flex justify-content-between gap-2 mt-3 pt-3 border-top">
              <button type="button" class="btn btn-sm btn-outline-primary" (click)="selectToday()">
                <i class="fas fa-calendar-day me-1"></i>
                {{ 'common.today' | translate }}
              </button>
              <button type="button" class="btn btn-sm btn-secondary" (click)="closePicker()">
                {{ 'common.close' | translate }}
              </button>
            </div>
          </div>
        </div>
      </div>
    }
  </div>
}

<!-- Floating Labels Layout -->
@if (visualizationType === 'floating') {
  <div class="mb-3">
    <div class="input-group">
      <div class="form-floating flex-grow-1">
        <input
          type="text"
          [id]="inputId"
          class="form-control"
          [class.is-invalid]="hasError()"
          [value]="displayValue()"
          [disabled]="disabled()"
          [placeholder]="placeholder || localizedPlaceholder()"
          [attr.aria-label]="label"
          [attr.aria-required]="required"
          [attr.aria-invalid]="hasError()"
          [attr.aria-describedby]="hasError() ? inputId + '-error' : helpText ? inputId + '-help' : null"
          (input)="onInput($event)"
          (blur)="onBlur()"
          autocomplete="off">
        <label [for]="inputId">
          {{ label }}
          @if (required) {
            <span class="text-danger">*</span>
          }
        </label>
      </div>
      <button
        class="btn btn-outline-secondary"
        [class.btn-outline-danger]="hasError()"
        (click)="togglePicker()"
        type="button"
        [disabled]="disabled()"
        [attr.aria-label]="'Open calendar'">
        <i class="fas fa-calendar"></i>
      </button>
    </div>
    @if (hasError()) {
      <div [id]="inputId + '-error'" class="invalid-feedback d-block">
        {{ errorMessage() }}
      </div>
    }
    @if (helpText && !hasError()) {
      <div [id]="inputId + '-help'" class="form-text">
        {{ helpText }}
      </div>
    }
    
    <!-- Calendar Picker Popup -->
    @if (showPicker()) {
      <div class="position-relative">
        <div class="calendar-picker-popup card shadow-lg position-absolute top-0 start-0 mt-1" style="z-index: 1050;">
          <div class="card-body p-3">
            <!-- Month/Year Navigation -->
            <div class="d-flex justify-content-between align-items-center mb-3">
              <div class="btn-group btn-group-sm" role="group">
                <button type="button" class="btn btn-outline-secondary" (click)="previousYear()" title="Previous year">
                  <i class="fas fa-angle-double-left"></i>
                </button>
                <button type="button" class="btn btn-outline-secondary" (click)="previousMonth()" title="Previous month">
                  <i class="fas fa-angle-left"></i>
                </button>
              </div>
              
              <h6 class="mb-0 fw-bold">{{ currentMonthName() }} {{ currentYear() }}</h6>
              
              <div class="btn-group btn-group-sm" role="group">
                <button type="button" class="btn btn-outline-secondary" (click)="nextMonth()" title="Next month">
                  <i class="fas fa-angle-right"></i>
                </button>
                <button type="button" class="btn btn-outline-secondary" (click)="nextYear()" title="Next year">
                  <i class="fas fa-angle-double-right"></i>
                </button>
              </div>
            </div>

            <!-- Weekday Headers -->
            <div class="calendar-grid mb-2">
              @for (weekDay of weekDayNames(); track $index) {
                <div class="calendar-weekday">{{ weekDay }}</div>
              }
            </div>

            <!-- Calendar Days -->
            <div class="calendar-grid">
              @for (dayInfo of calendarDays(); track dayInfo.date) {
                <button
                  type="button"
                  class="calendar-day"
                  [class.other-month]="!dayInfo.isCurrentMonth"
                  [class.today]="dayInfo.isToday"
                  [class.selected]="dayInfo.isSelected"
                  [disabled]="dayInfo.isDisabled"
                  (click)="selectDate(dayInfo.date)"
                  [title]="dayInfo.date">
                  {{ dayInfo.day }}
                </button>
              }
            </div>

            <!-- Footer with Today and Close buttons -->
            <div class="d-flex justify-content-between gap-2 mt-3 pt-3 border-top">
              <button type="button" class="btn btn-sm btn-outline-primary" (click)="selectToday()">
                <i class="fas fa-calendar-day me-1"></i>
                {{ 'common.today' | translate }}
              </button>
              <button type="button" class="btn btn-sm btn-secondary" (click)="closePicker()">
                {{ 'common.close' | translate }}
              </button>
            </div>
          </div>
        </div>
      </div>
    }
  </div>
}
