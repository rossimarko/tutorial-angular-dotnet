<div class="container-fluid py-4">
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h2 class="mb-1">{{ 'projects.title' | translate }}</h2>
      <p class="text-muted mb-0">{{ 'projects.manageProjects' | translate }}</p>
    </div>
    
    <div class="btn-group" role="group">
      <button type="button" class="btn btn-primary" (click)="createProject()">
        <i class="fas fa-plus me-2"></i>
        {{ 'projects.addProject' | translate }}
      </button>
      
      <!-- Export dropdown -->
      <button
        type="button"
        class="btn btn-outline-secondary dropdown-toggle"
        data-bs-toggle="dropdown"
        aria-expanded="false">
        <i class="fas fa-download me-1"></i>
        {{ 'common.export' | translate }}
      </button>
      <ul class="dropdown-menu dropdown-menu-end">
        <li>
          <button type="button" class="dropdown-item" (click)="exportCurrentPageToCSV()">
            <i class="fas fa-file-csv me-2"></i>
            {{ 'common.exportPageCSV' | translate }}
          </button>
        </li>
        <li>
          <button type="button" class="dropdown-item" (click)="exportCurrentPageToExcel()">
            <i class="fas fa-file-excel me-2"></i>
            {{ 'common.exportPageExcel' | translate }}
          </button>
        </li>
        <li><hr class="dropdown-divider"></li>
        <li>
          <button type="button" class="dropdown-item" (click)="exportAllToCSV()">
            <i class="fas fa-file-csv me-2"></i>
            {{ 'common.exportAllCSV' | translate }}
          </button>
        </li>
        <li>
          <button type="button" class="dropdown-item" (click)="exportAllToExcel()">
            <i class="fas fa-file-excel me-2"></i>
            {{ 'common.exportAllExcel' | translate }}
          </button>
        </li>
      </ul>
    </div>
  </div>

  <!-- Error Message -->
  @if (error()) {
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
      <i class="fas fa-exclamation-triangle me-2"></i>
      {{ error() }}
      <button type="button" class="btn-close"></button>
    </div>
  }

  <!-- Search and Filter Controls -->
  <div class="card mb-3">
    <div class="card-body">
      <div class="row g-3">
        <div class="col-md-6">
          <label for="search" class="form-label">{{ 'common.search' | translate }}</label>
          <input
            id="search"
            type="text"
            class="form-control"
            placeholder="{{ 'projects.searchPlaceholder' | translate }}"
            [formControl]="searchControl">
        </div>
        <div class="col-md-6">
          <label for="status" class="form-label">{{ 'common.status' | translate }}</label>
          <select id="status" class="form-select" [formControl]="statusFilter">
            <option value="">{{ 'common.all' | translate }}</option>
            @for (status of statuses; track status) {
              <option [value]="status">{{ status }}</option>
            }
          </select>
        </div>
      </div>
    </div>
  </div>

  <!-- Data Table Card -->
  <div class="card">
    <!-- Table -->
    <div class="table-responsive">
      <table class="table table-hover mb-0">
        <thead class="table-light">
          <tr>
            <th style="cursor: pointer;" (click)="sortByColumn('Title')">
              {{ 'projects.title' | translate }}{{ getSortIndicator('Title') }}
            </th>
            <th style="cursor: pointer;" (click)="sortByColumn('Status')">
              {{ 'common.status' | translate }}{{ getSortIndicator('Status') }}
            </th>
            <th style="cursor: pointer;" (click)="sortByColumn('Priority')">
              {{ 'projects.priority' | translate }}{{ getSortIndicator('Priority') }}
            </th>
            <th style="cursor: pointer;" (click)="sortByColumn('DueDate')">
              {{ 'projects.dueDate' | translate }}{{ getSortIndicator('DueDate') }}
            </th>
            <th style="cursor: pointer;" (click)="sortByColumn('CreatedAt')">
              {{ 'projects.createdAt' | translate }}{{ getSortIndicator('CreatedAt') }}
            </th>
            <th>{{ 'common.actions' | translate }}</th>
          </tr>
        </thead>
        <tbody>
          @if (loading()) {
            <tr>
              <td colspan="6" class="text-center py-4">
                <div class="spinner-border spinner-border-sm" role="status">
                  <span class="visually-hidden">{{ 'common.loading' | translate }}</span>
                </div>
              </td>
            </tr>
          } @else if (projects().length === 0) {
            <tr>
              <td colspan="6" class="text-center py-4 text-muted">
                {{ 'projects.noProjects' | translate }}
              </td>
            </tr>
          } @else {
            @for (project of projects(); track project.id) {
              <tr>
                <td class="fw-medium">{{ project.title }}</td>
                <td>
                  <span class="badge" [ngClass]="{
                    'bg-success': project.status === 'Active',
                    'bg-secondary': project.status === 'OnHold',
                    'bg-info': project.status === 'Completed',
                    'bg-danger': project.status === 'Cancelled'
                  }">
                    {{ project.status }}
                  </span>
                </td>
                <td>{{ project.priority }}</td>
                <td>{{ project.dueDate | localizedDate:'short' }}</td>
                <td>{{ project.createdAt | localizedDate:'short' }}</td>
                <td>
                  <div class="btn-group btn-group-sm" role="group">
                    <button
                      type="button"
                      class="btn btn-outline-primary"
                      (click)="viewProject(project)"
                      title="{{ 'common.view' | translate }}">
                      <i class="fas fa-eye"></i>
                    </button>
                    <button
                      type="button"
                      class="btn btn-outline-secondary"
                      (click)="editProject(project)"
                      title="{{ 'common.edit' | translate }}">
                      <i class="fas fa-pencil"></i>
                    </button>
                    <button
                      type="button"
                      class="btn btn-outline-danger"
                      (click)="deleteProject(project)"
                      title="{{ 'common.delete' | translate }}">
                      <i class="fas fa-trash"></i>
                    </button>
                  </div>
                </td>
              </tr>
            }
          }
        </tbody>
      </table>
    </div>

    <!-- Pagination Footer -->
    <div class="card-footer bg-light">
      <app-pagination
        [currentPage]="pageNumber()"
        [totalPages]="totalPages()"
        [pageSize]="pageSize()"
        [totalCount]="totalCount()"
        (pageChanged)="onPageChanged($event)"
        (pageSizeChanged)="onPageSizeChanged($event)">
      </app-pagination>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <app-confirm-dialog
    [show]="showDeleteConfirm()"
    title="Confirm Delete"
    [message]="'Are you sure you want to delete project: ' + projectToDelete()?.title + '?'"
    confirmText="Delete"
    cancelText="Cancel"
    confirmButtonClass="btn-danger"
    [loading]="deleting()"
    (confirmed)="confirmDelete()"
    (cancelled)="cancelDelete()">
  </app-confirm-dialog>
</div>